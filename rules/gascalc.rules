rule "Gas calc minute"
	when 
		Time cron "0 0/1 * * * ? *"
	then
		val Number gcons = WB_GasCounter.deltaSince(now.minusMinutes(1))
		if (gcons !== null) Gas_Cons.postUpdate(gcons*60)
		else Gas_Cons.postUpdate(0)
end

rule "Gas calc month"
	when 
		Time cron "0 5 0 * * ? *"
	then    
	val  ZonedDateTime 	zdtg = ZonedDateTime.now();
    val Number gcons_month = WB_GasCounter.deltaSince(zdtg.withDayOfMonth(1).toLocalDate().atStartOfDay(zdtg.getZone()));
    if (gcons_month !== null) Gas_ConsM.postUpdate(gcons_month);

end

rule "Gas calc today"
	when 
		Time cron "0 0/5 * * * ? *"
	then    
	val  ZonedDateTime 	zdt = ZonedDateTime.now()
    var  ZonedDateTime 	start_of_day = zdt.toLocalDate().atStartOfDay(zdt.getZone())
    var gcons_today = WB_GasCounter.deltaSince(start_of_day) as Number
	postUpdate(Gas_ConsToday, gcons_today);

end