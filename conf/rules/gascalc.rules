rule "Gas_calc_minute"
	when 
		Time cron "0 0/1 * * * ? *"
	then
		val gcons_moment = (WB_GasCounter.deltaSince(now().minusMinutes(1)) * 60) as Number;
		if (gcons_moment >= 0) Gas_Cons.postUpdate(gcons_moment);
end

rule "Gas_calc_month"
	when 
		Time cron "0 5 0 * * ? *"
	then    
	val  ZonedDateTime 	zdtg = ZonedDateTime.now();
    val gcons_month = WB_GasCounter.deltaSince(zdtg.withDayOfMonth(1).toLocalDate().atStartOfDay(zdtg.getZone())) as Number;
    if (gcons_month !== null) Gas_ConsM.postUpdate(gcons_month);
	GasMonthValue.postUpdate((Gas_ConsM.state as Number) * (GasValue.state as Number));

end

rule "Gas_calc_today"
	when 
		Time cron "0 0/5 * * * ? *"
	then    
	val  ZonedDateTime 	zdt = ZonedDateTime.now()
    val  ZonedDateTime 	start_of_day = zdt.toLocalDate().atStartOfDay(zdt.getZone())
    val gcons_today = WB_GasCounter.deltaSince(start_of_day) as Number
	Gas_ConsToday.postUpdate(gcons_today);

end